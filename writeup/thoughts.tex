\documentclass{article}
\usepackage[colorlinks=true, linkcolor=blue, citecolor=black, urlcolor=black]{hyperref}
\usepackage[style=trad-abbrv]{biblatex}
\usepackage{amsmath,amsthm,amssymb,dsfont}
\usepackage{algorithm,algpseudocodex}
\usepackage[section]{placeins}
%\usepackage{draftwatermark}
%\SetWatermarkScale{8}
%\SetWatermarkText{\normalfont{DRAFT}}

\newcommand{\PairDecomp}{\mathcal{W}}

\title{TSP and WSP Thoughts and Ideas}
\author{Addison Hanrattie}

\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{corollary}{Corollary}[thm]
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}


\newcommand{\BigLength}{\mathcal{L}}
\newcommand{\Cover}{\mathcal{C}}

\newcommand{\dist}{\delta}
%\DeclareMathOperator{\dist}{dist}

\DeclareMathOperator{\diam}{diam}

\begin{document}
\maketitle
\tableofcontents

\section{Work Area}
The main theorem I am proving here is Corollary~\ref{cor:wsp_tsp} and Theorem~\ref{thm:bin_wspd_tour_structure}.

\section{Definitions}
\subsection{Background Definitions}
\begin{defn}
    A \textbf{Pair Decomposition} is a of $P$ is a set of pairs
    $$\PairDecomp = \left\{ \{A_1, B_1\}, \ldots, \{A_k,B_k\} \right\}$$
    such that (I) $\forall i; A_i,B_i \subset P$, (II) $\forall i; A_i \cap B_i = \emptyset$, and (III) $\bigcup_{i=1}^k A_i \otimes B_i = \binom{P}{2} = P \otimes P$.
\end{defn}

\begin{defn}
    $\dist(Q,R) = \min_{q \in Q, r \in R} |qr|$
\end{defn}

\begin{defn}
    The pair $\{Q,R\}$ is \textbf{$s$-well-separated} if
    $$\max\{\diam(Q), \diam(R)\} \leq \frac{1}{s} \cdot \dist(Q,R)$$
\end{defn}

\subsection{My definitions}

\begin{defn}
    Let $P = A \cup B$ (with $A \cap B = \emptyset$). We say that $A$ and $B$ are \textbf{TSP-Separated} if the \emph{any} optimal TSP tour on $P$ visits all points in $A$ before any point in $B$ (or vice versa). 
    Furthermore, Let $P = A \cup B \cup C$ (with all three pairwise disjoint). We say that $A$, $B$, and $C$ are \textbf{TSP-Separated} if the \emph{any} optimal TSP tour on $P$ has exactly 3 or 4 edges connecting the three sets. 
\end{defn}

\begin{defn}
    Let $\{(A_1, B_1), \dots, (A_n, B_n)\} = \PairDecomp$ be a Well Separated Pair Decomposition of the point set $P$.
    We say that a given pair $(A_i, B_i) \in \PairDecomp$ is a \textbf{$k$-binary WSP} if either $A_i \cup B_i = P$ (which we call $1$-binary WSP) or there exists another pair $(A_j, B_j) \in \PairDecomp$ such that $A_i \cup B_i$ is equal to either $A_j$ or $B_j$ and furthermore the pair $(A_j, B_j)$ is a $(k-1)$-binary WSP.
\end{defn}

\begin{defn}
    A Well Separated Pair Decomposition $\PairDecomp$ of the point set $P$ is a \textbf{$k$-binary WSPD} if the union of all $k$-binary WSPs in $\PairDecomp$ is equal to $P$.
\end{defn}

\begin{defn}
    A Well Separated Pair Decomposition $\PairDecomp$ of the point set $P$ is a \textbf{full binary WSPD} if $\forall (A_i, B_i) \in \PairDecomp$ the pair is a $k$-binary WSP for some $k$.
\end{defn}

\section{Background Theorems}
\begin{thm}
Let $A$ and $B$ be two finite sets of points that are $s$-well-separated, let $p,p' \in A$, and let $q,q' \in B$. 
Then the following inequalities hold:
\begin{align*}
    |pq| &\leq (1 + 2/s) \cdot |pq'| \\
    |pq| &\leq (1 + 4/s) \cdot |p'q'| \\
    |pp'| &\leq (2/s) \cdot |pq| \\
\end{align*}
\end{thm}

\section{My Theorems}
\subsection{Hamiltonian Endpoint Distance Bound}

\begin{thm}[You can ignore]
Within a ball of diameter $d$ within a metric space the difference in shortest hamiltonian paths between any two points is at most $2d$.
\end{thm}
\begin{proof}
    Fix one pair of endpoints $(a,b)$ and let $P_{a,b}$ be the optimal Hamiltonian path from $a$ to $b$ with length denoted $L(a,b)$.
    Next consider another pair of endpoints $(c,d)$ we can then build a hamiltonian path from $c$ to $d$ using $P_{a,b}$.
    \begin{enumerate}
        \item Start at $c$
        \item Travel from $c$ to $a$ for a cost of $\dist(c,a) \leq d$
        \item Follow the path $P_{a,b}$ from $a$ to $b$ for a cost of $c \leq L(a,b)$. (shortcutting $c,d$)
        \item Travel from $b$ to $d$ for a cost of $\dist(b,d) \leq d$
    \end{enumerate}
    %WLOG assume that $c$ occurs before $d$ on the path $P_{a,b}$. 
    %Then let $x$ be the point which precedes $c$ on the path and let $x'$ be the point that immediately follows. 
    %In the same way define $y$ and $y'$ for point $d$.
    %Since the triangle inequality must be obeyed we know 
    Since the space obeys the triangle inequality we know that during step 3 we can only decrease the cost by shortcutting. Thus the total cost of this path is at most $L(a,b) + 2d$. Furthermore we know that this cost must ceil whatever the optimal hamiltonian path from $c$ to $d$ is. Thus we have shown that $L(c,d) \leq L(a,b) + 2d$. By symmetry of the argument we can also show that $L(a,b) \leq L(c,d) + 2d$. Combining these two inequalities we have that $\forall a,b,c,d;|L(a,b) - L(c,d)| \leq 2d$ as desired. 
\end{proof}
I haven't been able to prove it either way yet, but I believe the bound can be tightened for this theorem. 

\subsection{Well-Separated Sets are Path/Tour Separated}

\begin{thm}\label{thm:wsp_path_ab}
    Suppose we have two sets of points $A$ and $B$ that are $s$-well-separated where $s > 2$. Then the optimal hamiltonian path on $A \cup B$ with endpoints $a' \in A$ and $b' \in B$ must visit all points in $A$ before any point in $B$.
\end{thm}
\begin{proof}
    Let $|A| = n$ and $|B| = m$.
    WLOG assume that $n,m \geq 3$.

    Assume by contradiction that the optimal hamiltonian path on $A \cup B$ with endpoints $a' \in A$ and $b' \in B$ does not visit all points in $A$ before any point in $B$ (or vice versa).
    Then the optimal hamiltonian path on $A \cup B$ must contain at least three edges of the form ${a_i, b_i}$ where $a_i \in A$ and $b_i \in B$.
    WLOG let these edges be $\{a_1, b_1\}, \{b_2, a_2\}, \{a_3, b_3\}$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to a_2 \to \dots \to a_3 \to b_3 \to \dots \to b'$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    $|a_1 b_1| + |a_3 b_3| \leq |a_1 a_3| + |b_1 b_3|$.
    This is to say that the following path must be at least as long as the original path
    $$a' \to \dots \to a_1 \to a_3 \to \dots \to a_2 \to b_2 \to \dots \to b_1 \to b_3 \to \dots \to b'$$

    Since $A$ and $B$ are $s$-well-separated we know that $\forall i,j; |a_i a_j| \leq \frac{2}{s} |a_i b_i|$. From this we can conclude the following:
    \begin{align*}
        |a_1 b_1| + |a_3 b_3| &\leq |a_1 a_3| + |b_1 b_3| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |a_3 b_3| \\
        &= \frac{2}{s} (|a_1 b_1| + |a_3 b_3|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.
    Therefore the optimal hamiltonian path on $A \cup B$ with endpoints $a' \in A$ and $b' \in B$ must visit all points in $A$ before any point in $B$.
\end{proof}

\begin{thm}\label{thm:wsp_path_aa}
    Suppose we have two sets of points $A$ and $B$ that are $s$-well-separated where $s > 2$. Then the optimal hamiltonian path on $A \cup B$ with endpoints $a',a'' \in A$ must only contain two edges between $A$ and $B$.
\end{thm}
\begin{proof}
    Let $|A| = n$ and $|B| = m$.
    WLOG assume that $n,m \geq 4$.

    Assume by contradiction that the optimal hamiltonian path on $A \cup B$ with endpoints $a', a'' \in A$ contains at least four edges of the form $(a_i, b_i)$ where $a_i \in A$ and $b_i \in B$.
    WLOG let these edges be $\{a_1, b_1\}, \{b_2, a_2\}, \{a_3, b_3\}, \{b_4, a_4\}$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to a_2 \to \dots \to a_3 \to b_3 \to \dots \to b_4 \to a_4 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    $|b_2 a_2| + |b_4 a_4| \leq |b_2 b_4| + |a_2 a_4|$.
    This is to say that the following path must be at least as long as the original path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to b_4 \to \dots \to b_3 \to a_3 \to \dots \to a_2 \to a_4 \to \dots \to a''$$

    Since $A$ and $B$ are $s$-well-separated we know that $\forall i,j; |a_i a_j| \leq \frac{2}{s} |a_i b_i|$. From this we can conclude the following:
    \begin{align*}
        |b_2 a_2| + |b_4 a_4| &\leq |b_2 b_4| + |a_2 a_4| \\
        &\leq \frac{2}{s} |b_2 a_2| + \frac{2}{s} |b_4 a_4| \\
        &= \frac{2}{s} (|b_2 a_2| + |b_4 a_4|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.
    Therefore the optimal hamiltonian path on $A \cup B$ with endpoints $a', a'' \in A$ must only contain two edges between $A$ and $B$.
\end{proof}

\begin{corollary}\label{cor:wsp_tsp}
    Suppose we have two sets of points $A$ and $B$ that are $s$-well-separated where $s > 2$. Then $A$ and $B$ must be TSP-separated.
\end{corollary}

\subsection{Properly Structured WSPDs imply Tour Structure}

\begin{thm}\label{thm:bin_wspd_tour_structure}
    Let $P$ be a set of points and suppose we have a WSPD $\PairDecomp_s$ of $P$ with separation factor $s > 2$. 
    Then for any given $k$-binary WSP $(A_i, B_i) \in \PairDecomp_s$ there must exist exactly one or two edges in the optimal TSP tour on $P$ connecting them. Furthermore, there are exactly two edges exiting $A_i \cup B_i$ if they are not a $1$-binary WSP (aka the root pair).
\end{thm}
\begin{proof}
    This can be proved via induction. 
    For the top level pair of $(A_t, B_t) \in \PairDecomp_s$ where $A_t \cup B_t = P$ the result follows directly from Corollary~\ref{cor:wsp_tsp} which implies exactly two edges connect $A_t$ to $B_t$.
    
    Next consider the second level cluster $(A_t', B_t') \in \PairDecomp_s$. WLOG let $A_t' \cup B_t' = A_t$.
    By the previous case we know that there are exactly two edges exiting $A_t$. WLOG let one of these edges be of the form $\{a_*, d_*\}$ where $a_* \in A_t'$ and $d_* \in B_t$. We proceed with a case analysis.

    \textbf{Case 1:} The second edge exiting $A_t$ is of the form $\{b_*, d_\dagger\}$ where $b_* \in B_t'$ and $d_\dagger \in B_t$.
    Since there are no other edges exiting $A_t$ we know that the optimal TSP tour must contain a hamiltonian path on $A_t$ with endpoints $a_*$ and $b_*$.
    By Theorem~\ref{thm:wsp_path_ab} we know that this path must have exactly one edge connecting $A_t'$ to $B_t'$.

    \textbf{Case 2:} The second edge exiting $A_t$ is of the form $\{a_\dagger, d_\dagger\}$ where $a_\dagger \in A_t'$ and $d_\dagger \in B_t$.
    Since there are no other edges exiting $A_t$ we know that the optimal TSP tour must contain a hamiltonian path on $A_t$ with endpoints $a_*$ and $a_\dagger$.
    By Theorem~\ref{thm:wsp_path_aa} we know that this path must have exactly two edges connecting $A_t'$ to $B_t'$.

    Now consider the third level or lower pair $(A_i, B_i) \in \PairDecomp_s$. Assume by induction that for the parent pair $(C_p, D_p) \in \PairDecomp_s$ with $A_i \cup B_i = C_p$ there is exactly one or two edges connecting $C_p$ to $D_p$ in the optimal TSP tour and furthermore there are exactly two edges exiting $C_p$.

    Let $\{c_*, d_*\}$ be an edge connecting $C_p$ to $D_p$ in the optimal TSP tour.
    WLOG assume that $c_* \in A_i$ and define $a_* = c_*$ (the case where $c_* \in B_i$ is symmetric).
    We proceed with a case analysis.

    \textbf{Case 1:} There are two edges connecting $C_p$ to $D_p$ in the optimal TSP tour and the second edge is of the form $\{b_*, d_\dagger\}$ where $b_* \in B_i$ and $d_\dagger \in D_p$.
    Since there are no other edges exiting $C_p$ we know that the optimal TSP tour must contain a hamiltonian path on $C_p$ with endpoints $a_*$ and $b_*$.
    By Theorem~\ref{thm:wsp_path_ab} we know that this path must visit all points in $A_i$ before any point in $B_i$ (or vice versa).
    Thus there must be exactly one edge connecting $A_i$ to $B_i$. And exactly two edges $\{a_*, d_*\}, \{b_*, d_\dagger\}$ exiting $C_p$ as desired.

    \textbf{Case 2:} There are two edges connecting $C_p$ to $D_p$ in the optimal TSP tour and the second edge is of the form $\{a_\dagger, d_\dagger\}$ where $a_\dagger \in A_i$ and $d_\dagger \in D_p$.
    Since there are no other edges exiting $C_p$ we know that the optimal TSP tour must contain a hamiltonian path on $C_p$ with endpoints $a_*$ and $a_\dagger$.
    By Theorem~\ref{thm:wsp_path_aa} we know that this path must contain exactly two edges between $A_i$ and $B_i$. Furthermore there are exactly two edges $\{a_*, d_*\}, \{a_\dagger, d_\dagger\}$ exiting $C_p$ as desired.

    \textbf{Case 3:} There is only one edge connecting $C_p$ to $D_p$ in the optimal TSP tour and the other edge is of the form $\{a_\dagger, e_*\}$ where $a_\dagger \in A_i$ and $e_* \notin C_p \cup D_p$.
    Since there are no other edges exiting $C_p$ we know that the optimal TSP tour must contain a hamiltonian path on $C_p$ with endpoints $a_*$ and $a_\dagger$.
    By Theorem~\ref{thm:wsp_path_aa} we know that this path must only contain two edges between $A_i$ and $B_i$. Furthermore there are exactly two edges $\{a_*, d_*\}, \{a_\dagger, e_*\}$ exiting $C_p$ as desired.

    \textbf{Case 4:} There is only one edge connecting $C_p$ to $D_p$ in the optimal TSP tour and the other edge is of the form $\{b_*, e_*\}$ where $b_* \in B_i$ and $e_* \notin C_p \cup D_p$.
    Since there are no other edges exiting $C_p$ we know that the optimal TSP tour must contain a hamiltonian path on $C_p$ with endpoints $a_*$ and $b_*$.
    By Theorem~\ref{thm:wsp_path_ab} we know that this path must visit all points in $A_i$ before any point in $B_i$ (or vice versa).
    Thus there must be exactly one edges connecting $A_i$ to $B_i$. And exactly two edges $\{a_*, d_*\}, \{b_*, e_*\}$ exiting $C_p$ as desired.

    Therefore by induction we have shown that for any given pair $(A_i, B_i) \in \PairDecomp_s$ there must exist exactly one or two edges in the optimal TSP tour on $P$ connecting them. Furthermore, there are exactly two edges exiting $A_i \cup B_i$ if they are not the root clusters.
\end{proof}

There may be a way to deterministically say which of the two cases will occur based on the structure of the WSPD but I have not yet found it.

\subsection{Moving beyond binary WSPDs}

\begin{thm}
    Let $P = A \cup B \cup C$ be a set of points where $A,B,C$ are pairwise $s$-well-separated with $s > 2$. 
    Then a hamiltonian path which starts on a point $a' \in A$ and ends on a point $a'' \in A$ must have only three or four edges connecting the three sets.
\end{thm}
\begin{proof}
    To prove this we can observe two different cases. 

    \textbf{Case 1:} The optimal hamiltonian path on $P$ contains at least one edge connecting each pair of sets.
    WLOG let these edges be $(a_1, b_1), (b_2, c_1), (c_2, a_2)$ ordered as they appear in the path (if $c$ occurs before $b$ then flip the names).
    Assume by contradiction that the optimal hamiltonian path from $a'$ to $a''$ over $P$ requires more than four edges connecting the three sets.
    Then there must either be another loop connecting the three sets or there must be at least two more edges connecting one of the pairs of sets.

    \textbf{Subcase 1a:} There is another loop connecting the three sets both in the same orientation.
    Then the optimal path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, a_2)$, $(a_3, b_3)^*$, $(b_4, c_3)^*$, $(c_4, a_4)^*$ ordered as they appear in the path. This gives the following partial structure of the path:
    $$a' \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to a_2 \to \dots \to a_3 \to b_3 \to \dots \to b_4 \to c_3 \to \dots \to c_4 \to a_4 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 6-optimality condition implying the following:
    $|a_1 b_1| + |b_2 c_1| + |c_2 a_2| + |a_3 b_3| + |b_4 c_3| + |c_4 a_4| \leq |a_1 a_2| + |a_3 b_3| + |b_4 b_1| + |b_2 c_1| + |c_2 c_3| + |c_4 a_4|$.
    We can then rearrange this to get:
    \begin{align*}
        |a_1 b_1| + |c_2 a_2| + |b_4 c_3| &\leq |a_1 a_2| + |b_4 b_1| + |c_2 c_3| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |c_2 a_2| + \frac{2}{s} |b_4 c_3| \\
        &= \frac{2}{s} (|a_1 b_1| + |c_2 a_2| + |b_4 c_3|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subcase 1b:} There is another loop connecting the three sets in the opposite orientation.
    Then the optimal path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, a_2)$, $(a_3, c_3)^*$, $(c_4, b_3)^*$, $(b_4, a_4)^*$ ordered as they appear in the path. This gives the following partial structure of the path:
    $$a' \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to a_2 \to \dots \to a_3 \to c_3 \to \dots \to c_4 \to b_3 \to \dots \to b_4 \to a_4 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 6-optimality condition implying the following:
    $|a_1 b_1| + |b_2 c_1| + |c_2 a_2| + |a_3 c_3| + |c_4 b_3| + |b_4 a_4| \leq |a_1 a_2| + |a_3 c_3| + |c_4 c_2| + |c_1 b_2| + |b_1 b_3| + |b_4 a_4|$.
    We can then rearrange this to get:
    \begin{align*}
        |a_1 b_1| + |c_2 a_2| + |c_4 b_3| &\leq |a_1 a_2| + |c_2 c_4| + |b_1 b_3| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |c_2 a_2| + \frac{2}{s} |c_4 b_3| \\
        &= \frac{2}{s} (|a_1 b_1| + |c_2 a_2| + |c_4 b_3|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subcase 1c:} There must be at least two additional edges at the end causing a loop from $A$ to $B$.
    Then the optimal hamiltonian path must contain at least five edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, a_2)$, $(a_3, b_3)^*$, $(b_4, a_4)^*$ ordered as they appear in the path. 
    This gives the following partial structure of the path:
    $$a' \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to a_2 \to \dots \to a_3 \to b_3 \to \dots \to b_4 \to a_4 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_1 b_1| + |a_3 b_3| &\leq |a_1 a_3| + |b_1 b_3| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |a_3 b_3| \\
        &= \frac{2}{s} (|a_1 b_1| + |a_3 b_3|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subcase 1d:} There must be at least two additional edges at the end causing a loop from $A$ to $C$.
    Then the optimal hamiltonian path must contain at least five edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, a_2)$, $(a_3, c_3)^*$, $(c_4, a_4)^*$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to a_2 \to \dots \to a_3 \to c_3 \to \dots \to c_4 \to a_4 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |c_2 a_2| + |c_4 a_4| &\leq |c_2 c_4| + |a_2 a_4| \\
        &\leq \frac{2}{s} |c_2 a_2| + \frac{2}{s} |c_4 a_4| \\
        &= \frac{2}{s} (|c_2 a_2| + |c_4 a_4|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.


    \textbf{Subcase 1e:} There must be at least two additional edges connecting $A,B$ before starting the primary loop.
    Then the optimal hamiltonian path must contain at least five edges connecting the three sets.
    WLOG let these edges be $(a_3, b_3)^*$, $(b_4, a_4)^*$, $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, a_2)$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to a_3 \to b_3 \to \dots \to b_4 \to a_4 \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to a_2 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_3 b_3| + |a_1 b_1| &\leq |a_3 a_1| + |b_3 b_1| \\
        &\leq \frac{2}{s} |a_3 b_3| + \frac{2}{s} |a_1 b_1| \\
        &= \frac{2}{s} (|a_3 b_3| + |a_1 b_1|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subcase 1f:} There must be at least two additional edges connecting $A,C$ before starting the primary loop.
    Then the optimal hamiltonian path must contain at least five edges connecting the three sets.
    WLOG let these edges be $(a_3, c_3)^*$, $(c_4, a_4)^*$, $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, a_2)$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to a_3 \to c_3 \to \dots \to c_4 \to a_4 \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to a_2 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |c_4 a_4| + |c_2 a_2| &\leq |c_4 c_2| + |a_4 a_2| \\
        &\leq \frac{2}{s} |c_4 a_4| + \frac{2}{s} |c_2 a_2| \\
        &= \frac{2}{s} (|c_4 a_4| + |c_2 a_2|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subcase 1g:} There is a loop back from $B$ to $C$ before the primary loop is ended.
    Then the optimal hamiltonian path must contain at least five edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_4, b_3)^*$, $(b_4, c_3)^*$, $(c_2, a_2)$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_4 \to b_3 \to \dots \to b_4 \to c_3 \to \dots \to c_2 \to a_2 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |b_2 c_1| + |b_4 c_3| &\leq |b_2 b_4| + |c_1 c_3| \\
        &\leq \frac{2}{s} |b_2 c_1| + \frac{2}{s} |b_4 c_3| \\
        &= \frac{2}{s} (|b_2 c_1| + |b_4 c_3|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Case 2:} The optimal TSP tour on $P$ does not contain an edge connecting each pair of sets.
    \textbf{Subcase 2a:} WLOG let there only edges connecting $A$ to $B$ and $B$ to $C$ ($C$ and $B$ can be alternated symmetrically).
    Then the optimal hamiltonian path must contain at least four edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, b_3)$, $(b_4, a_2)$ ordered as they appear in the path.

    \textbf{Subsubcase 2a.i:} There is an extra loop connecting $A$ to $B$ before ending the path.
    Then the optimal hamiltonian path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_5, a_3)^*$, $(a_4, b_6)^*$, $(b_2, c_1)$, $(c_2, b_3)$, $(b_4, a_2)$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_5 \to a_3 \to \dots \to a_4 \to b_6 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to b_3 \to \dots \to b_4 \to a_2 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_1 b_1| + |a_4 b_6| &\leq |a_1 a_4| + |b_1 b_6| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |a_4 b_6| \\
        &= \frac{2}{s} (|a_1 b_1| + |a_4 b_6|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.
    
    \textbf{Subsubcase 2a.ii:} There is an extra loop connecting $B$ to $C$ before ending the path.
    Then the optimal hamiltonian path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_3, b_5)^*$, $(b_6, c_4)^*$, $(c_2, b_3)$, $(b_4, a_2)$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_3 \to b_5 \to \dots \to b_6 \to c_4 \to \dots \to c_2 \to b_3 \to \dots \to b_4 \to a_2 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |b_2 c_1| + |b_6 c_4| &\leq |b_2 b_6| + |c_1 c_4| \\
        &\leq \frac{2}{s} |b_2 c_1| + \frac{2}{s} |b_6 c_4| \\
        &= \frac{2}{s} (|b_2 c_1| + |b_6 c_4|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subsubcase 2a.iii:} There is an extra loop connecting $A,B$ after ending the path.
    Then the optimal hamiltonian path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, c_1)$, $(c_2, b_3)$, $(b_4, a_2)$, $(a_3, b_5)^*$, $(b_6, a_4)^*$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to c_1 \to \dots \to c_2 \to b_3 \to \dots \to b_4 \to a_2 \to \dots \to a_3 \to b_5 \to \dots \to b_6 \to a_4 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_1 b_1| + |a_3 b_5| &\leq |a_1 a_3| + |b_1 b_5| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |a_3 b_5| \\
        &= \frac{2}{s} (|a_1 b_1| + |a_3 b_5|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subcase 2b:} Let there only be edges connecting $A$ to $B$ and $A$ to $C$.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, a_2)$, $(a_3, c_1)$, $(c_2, a_4)$ ordered as they appear in the path (if $C$ occurs before $B$ then flip the names).

    \textbf{Subsubcase 2b.i:} There is an extra loop connecting $A$ to $B$ before ending the path.
    Then the optimal hamiltonian path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_5, a_3)^*$, $(a_4, b_6)^*$, $(b_2, a_2)$, $(a_5, c_1)$, $(c_2, a_6)$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_5 \to a_3 \to \dots \to a_4 \to b_6 \to \dots \to b_2 \to a_2 \to \dots \to a_5 \to c_1 \to \dots \to c_2 \to a_6 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_1 b_1| + |a_4 b_6| &\leq |a_1 a_4| + |b_1 b_6| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |a_4 b_6| \\
        &= \frac{2}{s} (|a_1 b_1| + |a_4 b_6|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subsubcase 2b.ii:} There is an extra loop connecting $A,C$ after ending the path.
    Then the optimal hamiltonian path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, a_2)$, $(a_3, c_1)$, $(c_2, a_4)$, $(a_5, c_3)^*$, $(c_4, a_6)^*$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to a_2 \to \dots \to a_3 \to c_1 \to \dots \to c_2 \to a_4 \to \dots \to a_5 \to c_3 \to \dots \to c_4 \to a_6 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_3 c_1| + |a_5 c_3| &\leq |a_3 a_5| + |c_1 c_3| \\
        &\leq \frac{2}{s} |a_3 c_1| + \frac{2}{s} |a_5 c_3| \\
        &= \frac{2}{s} (|a_3 c_1| + |a_5 c_3|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    \textbf{Subsubcase 2b.iii:} There is an extra loop connecting $A,B$ before ending the path.
    Then the optimal hamiltonian path must contain at least six edges connecting the three sets.
    WLOG let these edges be $(a_1, b_1)$, $(b_2, a_2)$, $(a_3, c_1)$, $(c_2, a_4)$, $(a_5, b_5)^*$, $(b_6, a_6)^*$ ordered as they appear in the path.
    This gives the following partial structure of the path:
    $$a' \to \dots \to a_1 \to b_1 \to \dots \to b_2 \to a_2 \to \dots \to a_3 \to c_1 \to \dots \to c_2 \to a_4 \to \dots \to a_5 \to b_5 \to \dots \to b_6 \to a_6 \to \dots \to a''$$

    Since the path is optimal we know that it satisfies the 2-optimality condition implying the following:
    \begin{align*}
        |a_1 b_1| + |a_5 b_5| &\leq |a_1 a_5| + |b_1 b_5| \\
        &\leq \frac{2}{s} |a_1 b_1| + \frac{2}{s} |a_5 b_5| \\
        &= \frac{2}{s} (|a_1 b_1| + |a_5 b_5|)
    \end{align*}
    This implies that $1 \leq \frac{2}{s}$ which in turn implies that $s \leq 2$ contradicting our original statement that $s > 2$.

    Therefore in all cases we have reached a contradiction when assuming that there are more than four edges connecting the three sets.
    Thus the optimal hamiltonian path from $a'$ to $a''$ over $P$ must have only three or four edges connecting the three sets.
\end{proof}

\begin{corollary}
    Let $P = A \cup B \cup C$ be a set of points where $A,B,C$ are pairwise $s$-well-separated with $s > 2$. 
    Then $A$, $B$, and $C$ must be TSP-separated.
\end{corollary}

%\begin{thm}
%    Let $P = A \cup B \cup C$ be a set of points where $A,B,C$ are pairwise $s$-well-separated with $s > 2$. 
%    Then a hamiltonian which starts on a point in $a' \in A$ and ends on a point in $c' \in C$ must visit all points in $B$ consecutively.
%    Furthermore, one of either $A$ or $C$ must be visited consecutively as well.
%\end{thm}
%\begin{proof}
%    Define $D = B \cup C$ and $E = A \cup B$.
%    Assume by contradiction that both $A$ and $C$s points are not visited consecutively.
%    Therefore we must have at least four edges of the following form $\{a_1, d_1\}$,
%\end{proof}

\section{Algorithms}

\begin{algorithm}[H]
\caption{\textsc{BalancedMetricSplit}$(D,s,k)$}
\label{alg:balanced_metric_split}
\begin{algorithmic}[1]
\Require A metric distance matrix $D \in \mathbb{R}^{n\times n}$ (symmetric, triangle inequality), separation factor $s>0$, and number of clusters $k \ge 2$
\Ensure A $k$-partition $\mathcal{P}=\{S_1,\dots,S_k\}$ that maximizes balance such that every pair of clusters is $s$-well-separated

\State $\mathcal{M} \gets \{D_{ij} \mid 1 \le i < j \le n\}$ \Comment{candidate diameter thresholds}
\State $\mathcal{S}^\star \gets \emptyset$; $\text{bestScore} \gets \infty$

\ForAll{$M \in \mathcal{M}$}
    \State $E_M \gets \{(i,j)\mid 1\le i<j\le n,\; D_{ij} < s\cdot M\}$
    \State $G_M \gets (V=\{1,\dots,n\}, E_M)$
    \State $\mathcal{C} \gets \textsc{ConnectedComponents}(G_M)$

    \If{$|\mathcal{C}| \neq k$}
        \State \textbf{continue}
    \EndIf

    \Comment{Diameter feasibility: ensure each component has diameter $\le M$}
    \State $\text{ok} \gets \textbf{true}$
    \ForAll{$C \in \mathcal{C}$}
        \If{$\diam(C) > M$}
            \State $\text{ok} \gets \textbf{false}$
            \State \textbf{break}
        \EndIf
    \EndFor
    \If{\textbf{not} ok}
        \State \textbf{continue}
    \EndIf

    \Comment{Separation feasibility: ensure pairwise separation}
    \State $\text{sep} \gets \textbf{true}$
    \ForAll{distinct $C, C' \in \mathcal{C}$}
        \State $\Delta(C,C') \gets \min\{D_{xy}\mid x\in C,\; y\in C'\}$
        \If{$\Delta(C,C') < s \cdot \max(\diam(C),\diam(C'))$}
            \State $\text{sep} \gets \textbf{false}$
            \State \textbf{break}
        \EndIf
    \EndFor
    \If{\textbf{not} sep}
        \State \textbf{continue}
    \EndIf

    \Comment{Balance objective: minimize size of largest cluster}
    \State $\text{score} \gets \max_{C\in\mathcal{C}} \bigl|C\bigr|$
    \If{$\text{score} < \text{bestScore}$}
        \State $\text{bestScore} \gets \text{score}$
        \State $\mathcal{S}^\star \gets \mathcal{C}$
    \EndIf
\EndFor

\State \Return $\mathcal{S}^\star$
\end{algorithmic}
\end{algorithm}

Analyzing the program there are $O(n^2)$ candidate diameter thresholds, and building the edge set takes $O(n^2)$ time, connected components takes $O(n+n^2)$ time, checking diameters takes $O(n^2)$ time, checking separation takes $O(k^2 (n-k)^2)$ [or $O(k^2 n^2)$], and updating the best score takes $O(k)$ time. Therefore the overall time complexity is $O(n^4 + k^2 n^4)$.

\subsubsection{Second Version}

\begin{algorithm}[H]
\caption{\textsc{BalancedMetricSplit2}$(D,s,k)$}
\label{alg:balanced_metric_split}
\begin{algorithmic}[1]
\Require A metric distance matrix $D \in \mathbb{R}^{n\times n}$ (symmetric, triangle inequality), separation factor $s>0$, and number of clusters $k \ge 2$
\Ensure A no more than $k$-partition $\mathcal{P}=\{S_1,\dots,S_k\}$ that maximizes balance such that every pair of clusters is $s$-well-separated (or a single cluster of all points is returned)

\State $\mathcal{M} \gets \{D_{ij} \mid 1 \le i < j \le n\}$ \Comment{candidate diameter thresholds}
\State $\mathcal{S}^\star \gets \big\{ \{1,2,\dots,n\} \big\}$; $\text{bestScore} \gets n$

\ForAll{$M \in \mathcal{M}$}
    \State $E_M \gets \{(i,j)\mid 1\le i<j\le n,\; D_{ij} < s\cdot M\}$
    \State $G_M \gets (V=\{1,\dots,n\}, E_M)$
    \State $\mathcal{C} \gets \textsc{ConnectedComponents}(G_M)$

    \If{$1 < |\mathcal{C}| \leq l$}
        \State \textbf{continue}
    \EndIf

    \Comment{Diameter feasibility: ensure each component has diameter $\le M$}
    \State $\text{ok} \gets \textbf{true}$
    \ForAll{$C \in \mathcal{C}$}
        \If{$\diam(C) > M$}
            \State $\text{ok} \gets \textbf{false}$
            \State \textbf{break}
        \EndIf
    \EndFor
    \If{\textbf{not} ok}
        \State \textbf{continue}
    \EndIf

    \Comment{Separation feasibility: ensure pairwise separation}
    \State $\text{sep} \gets \textbf{true}$
    \ForAll{distinct $C, C' \in \mathcal{C}$}
        \State $\Delta(C,C') \gets \min\{D_{xy}\mid x\in C,\; y\in C'\}$
        \If{$\Delta(C,C') < s \cdot \max(\diam(C),\diam(C'))$}
            \State $\text{sep} \gets \textbf{false}$
            \State \textbf{break}
        \EndIf
    \EndFor
    \If{\textbf{not} sep}
        \State \textbf{continue}
    \EndIf

    \Comment{Balance objective: minimize size of largest cluster}
    \State $\text{score} \gets \max_{C\in\mathcal{C}} \bigl|C\bigr|$
    \If{$\text{score} < \text{bestScore}$}
        \State $\text{bestScore} \gets \text{score}$
        \State $\mathcal{S}^\star \gets \mathcal{C}$
    \EndIf
\EndFor

\State \Return $\mathcal{S}^\star$
\end{algorithmic}
\end{algorithm}

\appendix
\section{Outdated proofs}
% this section is for if a better bound is found (ie proof is still valid but not as strong as desired)
\begin{thm}[There is a better bound]
    Suppose we have two sets of points $A$ and $B$ that are $s$-well-separated where $s > 2.5$. Then $A$ and $B$ must be TSP-separated.
\end{thm}

\section{Dead ends}
% these theorems are false

%Let $A$ and $B$ be two finite sets of points that are TSP-separated. 
%Let $\Cover_k(S)$ denote the optimal cost of $k$ disjoint hamiltonian paths covering all points in set $S$.
%Let $\BigLength_{2k}(A,B)$ be the sum of the $2k$ shortest edges between $A$ and $B$ without point replacement.
%Then, $\Cover_1(A) + \Cover_1(B) + \BigLength_{2}(A,B) \leq \Cover_k(A) + \Cover_k(B) + \BigLength_{2k}(A,B)$.

%Let $A$ and $B$ be two finite sets of points that are TSP-separated. Then $\dist(A,B) \geq \max(\lambda(A), \lambda(B))$.
%[Where $\lambda(A) = \max(|a_1 a_2|, |a_2 a_3|, \dots, |a_{n-1} a_n|)$ so that it represents the longest edge in the hamiltonian path through $A$ which is derived as a subpath of the optimal TSP tour on $A \cup B$. The same definition applies to $\lambda(B)$.]

\end{document}